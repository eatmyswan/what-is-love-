$('.filters_wrap a').removeClass('active');
$('#week').addClass('active');
$('#pad').replaceWith("<%= escape_javascript render('capture')  %>");
$('.categories_wrap').replaceWith("<%= escape_javascript render('side_plan')  %>");
$('#cal_btn, #notifications_btn, #datepicker.acct_datepicker').hide();


$(document).ready(function() {
	
	calculateResultCount();
	
	var dayNumber = parseInt("<%= @start_date.day %>");
	
	$( "#datepicker" ).datepicker({
		defaultDate: "<%= @start_date %>",
		showOtherMonths: true,
		dateFormat: 'yy-mm-dd',
		dayNamesMin: ['S','M','T','W','T','F','S'],
		beforeShowDay: function(date){
			var title = dbDate(date);
			if((date.getDate() >= dayNumber) && (date.getDate() < dayNumber + 7)){
				if(date.getDay() == 0) return [1,'droppable sunday active_week',title];
				if(date.getDay() == 6) return [1,'droppable saturday active_week',title];
				return [1,'droppable active_week',title];
			}
			if(date.getDay() == 0) return [1,'droppable sunday',title];
			if(date.getDay() == 6) return [1,'droppable saturday',title];
			return [1,'droppable',title];
		},
		onSelect: function(dateText, inst){
			$.ajax({
				url: "/week/capture/" + dateText,
				type: 'GET'
			});
		},
		onChangeMonthYear: function(year, month, inst) { 
			$('#datepicker').data("init", false);
		}
	});


});

function dbDate(date){
	var year = date.getFullYear();
	var month = date.getMonth() + 1;
		month = month.toString();
		month = (month.length == 1) ? '0'+month : month;
	var day = date.getDate().toString();
		day = (day.length == 1) ? '0'+day : day;
	return year+'-'+month+'-'+day;
}

function calculateResultCount() {
	var count = $('#side_plan').children().length;
	$('.result_count_wrap .count').text(count);
}
