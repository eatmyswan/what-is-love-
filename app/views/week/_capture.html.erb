
<% content_for :top do %>

		<div class="calendar_title">
			<span class="big"><%= @start_date.strftime('%B %e') %> - <%= @end_date.strftime('%e') %></span>
		</div>
		<div id="next_prev_wrap">
			<%= link_to week_capture_path(@start_date - 7.days), :class => 'filter rounded_left', :remote => true do %>
				<div class="prev"></div>
			<% end %>
			<%= link_to 'Today', week_capture_path(Date.today()), :class => 'filter', :remote => true %>
			<%= link_to week_capture_path(@start_date + 7.days), :class => 'filter rounded_right', :remote => true do %>
				<div class="next"></div>
			<% end %>
		</div>
		<div id="calendar_controls">
			<%= link_to 'Capture', week_capture_path(@start_date), :id => 'week_capture', :class => 'filter rounded_left active', :remote => true %>
			<%= link_to 'Plan', week_plan_path(@start_date), :id => 'week_plan', :class => 'filter', :remote => true %>
			<%= link_to 'Forecast', week_forecast_path(@start_date), :id => 'week_forecast', :class => 'filter rounded_right', :remote => true %>
		</div>
		<div class="ribbon"></div>

<% end %>

<% content_for :page do %>
	<div id="group">
		<div id="capture_wrap">
			<div id="input_wrap">
				<span class="inner_shadow"></span>
				<%= form_for(Task.new, :remote => true) do |f| %>
					<%= f.text_field :title, :autocomplete => :off, :value => "New Action...", :onfocus => '(this.value == "New Action...") ? this.value = "" : this.value', :onblur => '(this.value == "") ? this.value = "New Action..." : this.value' %>
					<%= f.hidden_field :start, :value => @start_date %>
					<%= f.hidden_field :group_id, :value => @inbox.id.to_s %>
					<%= f.hidden_field :week, :value => 'true' %>
				<% end %>
			</div>
			<div id="incomplete">
				<div id="<%= @inbox.id %>" class="capture_group_wrap_inbox">
					<ul class="sortable incomplete_task_list">
						<% @inbox.tasks.where(:start.gte => @start_date, :start.lt => @end_date).and(complete: false).and(parent_id: nil).and(plan: false).order_by([:capture_sort, :asc]).each do |task,index| %>
							<%= render :partial => '/tasks/task', :locals => { :task => task, :action_plan => 'true' } %>
						<% end %>
					</ul>
				</div>
			
				<% @groups.each do |group| %>
						<div id="<%= group.id %>" class="capture_group_wrap" style="<%= 'display: none;' if group.tasks.where(:start.gte => @start_date, :start.lt => @end_date).and(complete: false).and(parent_id: nil).count == 0 %>">
							<div class="group_top_wrap">
								<span class="img_wrap"><%= image_tag group.images.forward.first.image.tiny if group.images.forward.first %></span>
								<span class="title_wrap"><%= group.title %></span>
							</div>
							<ul class="sortable group_bottom_wrap">
								<% group.tasks.where(:start.gte => @start_date, :start.lt => @end_date).and(complete: false).and(parent_id: nil).and(plan: false).order_by([:capture_sort, :asc]).each do |task,index| %>
									<%= render :partial => '/tasks/task', :locals => { :task => task, :action_plan => 'true' } %>
								<% end %>
							</ul>
						</div>
				<% end %>
			</div>
		</div>
	</div>
<% end %>

<%= render '/home/pad' %>
