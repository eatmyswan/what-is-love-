$('.filters_wrap a').removeClass('active');
$('#day').addClass('active');
$('#pad').replaceWith("<%= escape_javascript render('capture')  %>");
$('.categories_wrap').replaceWith("<%= escape_javascript render('side_plan')  %>");



$(document).ready(function() {
	
	$( "#datepicker" ).datepicker({
		defaultDate: "<%= @start_date %>",
		showOtherMonths: true,
		dateFormat: 'yy-mm-dd',
		dayNamesMin: ['S','M','T','W','T','F','S'],
		beforeShowDay: function(date){
			var title = dbDate(date);
			return [1,'droppable',title];
		},
		onSelect: function(dateText, inst){
			$.ajax({
				url: "/day/capture/" + dateText,
				type: 'GET'
			});
		}
	});

	$('#datepicker .droppable').droppable({
		accept: '.task_wrap',
		tolerance: 'pointer',
		over: function(event,ui){
			$('.dragging_task').css('opacity',0.3);
			$(this).addClass('ui-datepicker-over');
		},
		out: function(event,ui){
			$(this).removeClass('ui-datepicker-over');
		},
		drop: function(event,ui){
			$('ul.sortable').sortable('cancel');
			var taskId = ui.draggable.attr('id');
			var date = $(this).attr('title');
			ui.draggable.remove();
			$.ajax({
				url: "/tasks/" + taskId,
				type: 'PUT',
				data: $.param({task : { start: date }})
			});
		}
	});

});

function dbDate(date){
	var year = date.getFullYear();
	var month = date.getMonth() + 1;
		month = month.toString();
		month = (month.length == 1) ? '0'+month : month;
	var day = date.getDate().toString();
		day = (day.length == 1) ? '0'+day : day;
	return year+'-'+month+'-'+day;
}
	
